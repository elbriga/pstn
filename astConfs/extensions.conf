; database put config/gabriel CID 4133225566
; database put config/gabriel ocupado 8
; database put config/gabriel naoAtende 6
; database put config/gabriel secEletr 10
; database put config/gabriel mohMin 10
; database put config/gabriel mohMax 50
; database put config/gabriel congestion 3

[default]
include => pstn

;
; Contexto para gerar ligacoes entrantes nas VMs de desenvolvimento
; Uso: channel originate Local/[aliasVM][NUMERO entrante VM]@saidaParaVMs [application/extension] [app ou exten]
;
; Exemplo: channel originate Local/gab1235@saidaParaVMs application MusicOnHold
; Neste caso ira para Musica de Espera indefinidamente
;
[saidaParaVMs]
exten => _tstX.,1,Set(CALLERID(num)=4133225567)
exten => _tstX.,n,Dial(SIP/${EXTEN:3}@teste,60)

[pstn]
exten => _1XX,1,Macro(simula-pstn,ligacao-servico)
exten => _1XXXX,1,Macro(simula-pstn,ligacao-servico)
exten => _0[3489]00XXXX.,1,Macro(simula-pstn,ligacao-0800)
exten => _[2-5]XXXXXXX,1,Macro(simula-pstn,ligacao-fixo-local)
exten => _[6-9]XXXXXXX,1,Macro(simula-pstn,ligacao-movel-local)
exten => _9XXXXXXXX,1,Macro(simula-pstn,ligacao-movel-local)
exten => _0XXXX[2-5]XXXXXXX,1,Macro(simula-pstn,ligacao-fixo-ddd)
exten => _0XXXX[6-9]XXXXXXX,1,Macro(simula-pstn,ligacao-movel-ddd)
exten => _0XXXX9XXXXXXXX,1,Macro(simula-pstn,ligacao-movel-ddd)
exten => _00XXXX.,1,Macro(simula-pstn,ligacao-ddi)
exten => _XXX.,1,Macro(simula-pstn,ligacao-nao-identificado)


[macro-simula-pstn]
; simular o desempenho do mailing de acordo com as metricas:
; 20% - Atendimento humano
; 20% - Secretaria eletronica
; 20% - Mensagem operadora
; 10% - Nao atende
; 20% - Ocupado
; 10% - Nao existe
exten => s,1,NoOp(Simulando desempenho do mailing - cid:${CALLERID(num)} - chan:${CHANNEL})

exten => s,n,Set(RND=${RAND(1,100)})
;exten => s,n,Set(RND=99) ; 100% - Atendimento humano 
;exten => s,n,Set(RND=9)  ; 100% - Ocupado
;exten => s,n,Set(RND=20) ; 100% - Não Existe
;exten => s,n,Set(RND=45) ; 100% - Secretaria Eletronica. 
;exten => s,n,Set(RND=70) ; 100% - Não Atende. 
;exten => s,n,Set(RND=80) ; 100% - Descarte


;; Chamadas vindas de IP especifico 
exten => s,n,ExecIf($[ "${REGEX("10\.3\.0\.2-" ${CHANNEL})}" == "1" ]?Set(RND=9))
;exten => s,n,ExecIf($[ "${REGEX("10\.3\.0\.25-" ${CHANNEL})}" == "1" ]?Set(RND=55))

exten => s,n,GotoIf($[ ${RND} < 10 ]?simula-ocupado)
exten => s,n,GotoIf($[ ${RND} < 25 ]?simula-naoexiste)
exten => s,n,GotoIf($[ ${RND} < 55 ]?simula-operadora)
exten => s,n,GotoIf($[ ${RND} < 65 ]?simula-maquina)
exten => s,n,GotoIf($[ ${RND} < 75 ]?simula-naoatende)
exten => s,n,GotoIf($[ ${RND} < 85 ]?simula-isdn-descarte)
exten => s,n,GotoIf($[ ${RND} < 90 ]?simula-isdn-erro)
exten => s,n,GotoIf($[ ${RND} == 110 ]?simula-encaminha)


exten => s,n(simula-humano),NoOp(Simulacao - HUMANO - (${RND}))

exten => s,n,Ringing()
exten => s,n,Wait(5)

exten => s,n,Playback(atendimento-humano)
exten => s,n,Goto(moh)

exten => s,n(simula-ocupado),NoOp(Simulacao - OCUPADO - (${RND}))
exten => s,n,Busy()

exten => s,n(simula-naoexiste),NoOp(Simulacao - NAO EXISTE - (${RND}))
exten => s,n,Hangup(1)

exten => s,n(simula-maquina),NoOp(Simulacao - SECRETARIA ELETRONICA - (${RND}))
exten => s,n,Ringing()
exten => s,n,Wait(3)
exten => s,n,Answer()
;exten => s,n,Playback(atendimento-maquina)
exten => s,n,Playback(atendimento-maquina-vivo2)
exten => s,n,Goto(moh)

exten => s,n(simula-operadora),NoOp(Simulacao - MENSAGEM OPERADORA - (${RND}))
exten => s,n,Playback(atendimento-maquina)
exten => s,n,Hangup()

exten => s,n(simula-naoatende),NoOp(Simulacao - NAO ATENDE - (${RND}))
exten => s,n,Wait(300)
exten => s,n,Hangup()

exten => s,n(simula-isdn-descarte),NoOp(Simulacao - ISDN DESCARTE (20) - (${RND}))
exten => s,n,Hangup(20)

exten => s,n(simula-isdn-erro),NoOp(Simulacao - ISDN ERRO (58) - (${RND}))
exten => s,n,Hangup(58)

;exten => s,n(moh),MusicOnHold(default,${RAND(30,60)})
exten => s,n(moh),MusicOnHold(default,30)
exten => s,n,Hangup()

exten => s,n(simula-encaminha),NoOp(internal-phone-call - (${RND}))
exten => s,n,Ringing
exten => s,n,answer()
exten => s,n,Dial(SIP/vmrafael,12,r)

